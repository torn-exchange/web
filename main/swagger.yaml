openapi: 3.1.0
info:
  title: TE API
  version: 1.0.0
  description: |
    API documentation for the Torn Exchange API.

    **Rate Limiting:**

    - Maximum **10 requests per minute** per IP.
    - If exceeded, requests will be blocked with an exponential backoff penalty.
    - Backoff starts at 15 seconds and doubles with each violation, capped at 48 hours.
    - Example backoff sequence (seconds): 15, 30, 60, 120, 240, ..., up to 172800 (48 hours).
    - Max theoretical allowed requests per day without penalty: ~14,400.
    - If the API is continuously used at the rate limit, you may be banned permanently.
    - Rate limit violations return HTTP 429 with JSON payload:
      ```json
      {
        "status": "error",
        "rate_limited": true,
        "retry_after": <seconds>
      }
      ```

paths:
  /api/status:
    get:
      summary: Check API status
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: string
                    example: "API is working"

  /api/price:
    get:
      summary: Get item price for a specific user
      parameters:
        - name: user_id
          in: query
          required: true
          schema:
            type: string
        - name: item_id
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Price details
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      trader:
                        type: string
                      price:
                        type: integer
                      item:
                        type: string
        '404':
          description: Not found

  /api/profile:
    get:
      summary: Get user profile
      parameters:
        - name: user_id
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Profile details
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      name:
                        type: string
                      torn_id:
                        type: string
                      activity_status:
                        type: string
                      last_active:
                        type: string
                      created_at:
                        type: string
                      updated_at:
                        type: string
                      votes:
                        type: integer
                      reviews:
                        type: string

  /api/te_price:
    get:
      summary: Get TE and Torn market prices for an item
      parameters:
        - name: item_id
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Item prices
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      item:
                        type: string
                      te_price:
                        type: integer
                      torn_price:
                        type: integer

  /api/prices:
    get:
      summary: Get Trader's price list
      responses:
        '200':
          description: Trader's price list
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        item_id:
                          type: integer
                        item_name:
                          type: string
                        te_price:
                          type: integer
                        torn_price:
                          type: integer

  /api/listings:
    get:
      summary: List item listings with pagination
      parameters:
        - name: item_id
          in: query
          required: true
          schema:
            type: string
        - name: sort_by
          in: query
          schema:
            type: string
            default: price
            enum:
              - price
        - name: order
          in: query
          schema:
            type: string
            default: asc
            enum:
              - asc
              - desc
        - name: page
          in: query
          schema:
            type: integer
            default: 1
      responses:
        '200':
          description: Listings with pagination metadata
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      item:
                        type: string
                      meta:
                        type: object
                        properties:
                          total_listings:
                            type: integer
                          total_pages:
                            type: integer
                          current_page:
                            type: integer
                      listings:
                        type: array
                        items:
                          type: object
                          properties:
                            trader:
                              type: string
                            price:
                              type: integer
                            item:
                              type: string

  /api/best_listing:
    get:
      summary: Get best (highest price) listing for an item
      parameters:
        - name: item_id
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Best listing
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      item:
                        type: string
                      trader:
                        type: string
                      price:
                        type: integer

  /api/receipts:
    get:
      summary: User trade receipts
      parameters:
        - name: key
          in: query
          required: true
          schema:
            type: string
        - name: format
          in: query
          schema:
            type: string
            enum:
              - json
              - csv
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: per_page
          in: query
          schema:
            type: integer
            default: 100
      responses:
        '200':
          description: Receipts with pagination
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        created_at:
                          type: string
                        seller:
                          type: string
                        total:
                          type: number
                        profit:
                          type: number
                        url:
                          type: string
                  meta:
                    type: object
                    properties:
                      count:
                        type: integer
                      page:
                        type: integer
                      per_page:
                        type: integer
                      total_pages:
                        type: integer

  /api/receipt/{receipt_id}:
    get:
      summary: Get details for a specific receipt
      parameters:
        - name: receipt_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Receipt details with items
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  data:
                    type: object
                  meta:
                    type: object
                    properties:
                      receipt_id:
                        type: string
                      created_at:
                        type: string
                      seller:
                        type: string
                      total:
                        type: number
                      profit:
                        type: number

  /api/sellers:
    get:
      summary: Get sellers information for authenticated user
      parameters:
        - name: key
          in: query
          required: true
          schema:
            type: string
        - name: format
          in: query
          schema:
            type: string
            enum:
              - json
              - csv
      responses:
        '200':
          description: Sellers data with statistics
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        trades:
                          type: integer
                        profit:
                          type: integer
                        last_traded:
                          type: string
                  meta:
                    type: object
                    properties:
                      count:
                        type: integer

  /api/active_traders:
    get:
      summary: Get list of active traders
      responses:
        '200':
          description: Active traders data
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      ids:
                        type: array
                        items:
                          type: integer
                      verbose:
                        type: object
                        additionalProperties:
                          type: object
                          properties:
                            name:
                              type: string
                            torn_id:
                              type: integer
                            last_trade:
                              type: integer

  /api/prices/{identifier}:
    get:
      summary: Get pricelist for a specific trader
      parameters:
        - name: identifier
          in: path
          required: true
          description: Trader name or Torn ID
          schema:
            type: string
      responses:
        '200':
          description: Trader's pricelist
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          type: object
                          properties:
                            item_id:
                              type: integer
                            name:
                              type: string
                            price:
                              type: integer
                  meta:
                    type: object
                    properties:
                      description:
                        type: string
                      trader:
                        type: string
                      vote_score:
                        type: number
                      last_updated:
                        type: string
                      time_since_last_trade:
                        type: string

  /api/modify_listing:
    post:
      summary: Modify a listing by updating its price or deleting it
      description: |
        This endpoint allows you to modify a listing by either updating its price, updating its discount, or deleting it.
        - To update the price, provide the `fixed_price` parameter with the (torn) `item_id`.
        - To update the discount, provide the `discount` parameter with the (torn) `item_id`.
        - To update both the price and discount, provide both parameters with the (torn) `item_id`.
        - To delete the listing, provide the `action: delete` field for the item you wish to remove, this can be set at the parent level OR per listing item.
        - You cannot delete a listing by posting `action: update` with discount and fixed_price not set.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                key:
                  type: string
                  description: The torn api key to authorize the request
                  example: "192XXXXXXXX931XX"
                action:
                  type: string
                  description: Action to be taken on the listing (either `update` or `delete`)
                  enum:
                    - update
                    - delete
                  example: delete
                listings:
                  type: array
                  items:
                    type: object
                    properties:
                      item_id:
                        type: integer
                        description: The ID of the item to modify
                        example: 206
                      fixed_price:
                        type: integer
                        description: The fixed price of the item (optional for update - must have either fixed_price or discount)
                        example: 780000
                      discount:
                        type: number
                        format: float
                        description: The discount percentage. Cannot be more than 100 or less than 0 (optional for update - must have either fixed_price or discount)
                        example: 50
                        minimum: 0
                        maximum: 100
                      action:
                        type: string
                        description: Action to be taken on the listing (either `update` or `delete`)
                        enum:
                          - update
                          - delete
                        example: delete
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      updated_listings:
                        type: array
                        items:
                          type: integer
                        example: [ 206, 200, 197 ]
                      failed_listings:
                        type: array
                        items:
                          type: integer
                        example: [ ]
                      deleted_listings:
                        type: array
                        items:
                          type: integer
                        example: [ ]
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: "Invalid request parameters"
        '404':
          description: Listing not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: "Listing not found"